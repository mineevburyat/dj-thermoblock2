<!-- Модальное окно калькулятора -->
<div class="modal fade" id="calculatorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-calculator-fill text-primary me-2"></i>
                    Расчет стоимости строительства
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="calculatorForm">
                    <!-- Шаги расчета -->
                    <div class="steps mb-4">
                        <div class="step active" data-step="1">Параметры</div>
                        <div class="step" data-step="2">Модель</div>
                        <div class="step" data-step="3">Результат</div>
                    </div>
                    
                    <!-- Шаг 1: Параметры -->
                    <div class="step-content active" id="step1">
                        <h6 class="mb-3">Основные параметры дома</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Длина дома (м)</label>
                                <input type="number" class="form-control" name="length" min="5" max="50" value="10" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ширина дома (м)</label>
                                <input type="number" class="form-control" name="width" min="5" max="50" value="8" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Высота этажа (м)</label>
                                <input type="number" class="form-control" name="height" min="2.5" max="5" step="0.1" value="3" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Количество этажей</label>
                                <select class="form-select" name="floors" required>
                                    <option value="1">1 этаж</option>
                                    <option value="1.5" selected>1.5 этажа (мансарда)</option>
                                    <option value="2">2 этажа</option>
                                    <option value="3">3 этажа</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Шаг 2: Модель блока -->
                    <div class="step-content" id="step2">
                        <h6 class="mb-3">Выберите модель ThermoBlock</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check card">
                                    <input class="form-check-input" type="radio" name="model" id="modelStandard" value="standard" checked>
                                    <label class="form-check-label card-body" for="modelStandard">
                                        <h6 class="card-title">ThermoBlock Стандарт</h6>
                                        <p class="card-text text-muted small">Для дачных домов, гаражей</p>
                                        <div class="text-primary fw-bold">от 1 850 ₽/м²</div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check card">
                                    <input class="form-check-input" type="radio" name="model" id="modelPlus" value="plus">
                                    <label class="form-check-label card-body" for="modelPlus">
                                        <h6 class="card-title">ThermoBlock Плюс</h6>
                                        <p class="card-text text-muted small">Коттеджи для ПМЖ</p>
                                        <div class="text-primary fw-bold">от 2 150 ₽/м²</div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check card">
                                    <input class="form-check-input" type="radio" name="model" id="modelPremium" value="premium">
                                    <label class="form-check-label card-body" for="modelPremium">
                                        <h6 class="card-title">ThermoBlock Премиум</h6>
                                        <p class="card-text text-muted small">Элитные дома, бани</p>
                                        <div class="text-primary fw-bold">от 2 650 ₽/м²</div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check card">
                                    <input class="form-check-input" type="radio" name="model" id="modelSeismic" value="seismic">
                                    <label class="form-check-label card-body" for="modelSeismic">
                                        <h6 class="card-title">ThermoBlock Сейсмо</h6>
                                        <p class="card-text text-muted small">Сейсмичные районы</p>
                                        <div class="text-primary fw-bold">от 3 150 ₽/м²</div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Шаг 3: Результат и форма -->
                    <div class="step-content" id="step3">
                        <div class="calculation-result mb-4">
                            <h6 class="mb-3">Примерный расчет:</h6>
                            <div class="alert alert-primary">
                                <div class="d-flex justify-content-between">
                                    <span>Общая площадь стен:</span>
                                    <strong id="wallAreaResult">156 м²</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Требуется блоков:</span>
                                    <strong id="blocksResult">~624 шт</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Стоимость материалов:</span>
                                    <strong id="materialsResult">~289 000 ₽</strong>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between fs-5">
                                    <span>Примерная стоимость:</span>
                                    <strong class="text-primary" id="totalResult">~328 900 ₽</strong>
                                </div>
                            </div>
                            <p class="text-muted small">
                                * Точный расчет предоставит наш специалист после консультации
                            </p>
                        </div>
                        
                        <h6 class="mb-3">Оставьте контакты для детального расчета</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ваше имя</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Телефон</label>
                                <input type="tel" class="form-control" name="phone" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" name="email">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Комментарий (необязательно)</label>
                                <textarea class="form-control" name="comment" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="prevStep" style="display: none;">
                    <i class="bi bi-arrow-left me-1"></i>Назад
                </button>
                <button type="button" class="btn btn-primary" id="nextStep">
                    Далее <i class="bi bi-arrow-right ms-1"></i>
                </button>
                <button type="submit" form="calculatorForm" class="btn btn-success" id="submitForm" style="display: none;">
                    <i class="bi bi-send me-1"></i>Отправить заявку
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно успешной отправки -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center py-5">
                <div class="mb-4">
                    <i class="bi bi-check-circle-fill text-success display-1"></i>
                </div>
                <h4 class="mb-3">Заявка отправлена!</h4>
                <p class="text-muted mb-4">
                    Наш специалист свяжется с вами в течение 15 минут для детального расчета.
                </p>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                    Понятно, спасибо!
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Стили для шагов */
    .steps {
        display: flex;
        justify-content: space-between;
        position: relative;
    }
    
    .steps::before {
        content: '';
        position: absolute;
        top: 15px;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--bs-gray-300);
        z-index: 1;
    }
    
    .step {
        position: relative;
        z-index: 2;
        background: white;
        padding: 5px 15px;
        border-radius: 20px;
        border: 2px solid var(--bs-gray-300);
        color: var(--bs-gray-600);
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .step.active {
        border-color: var(--bs-primary);
        color: var(--bs-primary);
        background: rgba(var(--bs-primary-rgb), 0.1);
    }
    
    /* Контент шагов */
    .step-content {
        display: none;
    }
    
    .step-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    /* Стили для карточек моделей */
    .form-check.card {
        border: 2px solid var(--bs-gray-300);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .form-check.card:hover {
        border-color: var(--bs-primary);
    }
    
    .form-check-input:checked ~ .card-body {
        background: rgba(var(--bs-primary-rgb), 0.05);
    }
    
    .form-check-input {
        position: absolute;
        top: 10px;
        right: 10px;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const calculatorForm = document.getElementById('calculatorForm');
        const steps = document.querySelectorAll('.step');
        const stepContents = document.querySelectorAll('.step-content');
        const prevBtn = document.getElementById('prevStep');
        const nextBtn = document.getElementById('nextStep');
        const submitBtn = document.getElementById('submitForm');
        
        let currentStep = 1;
        const totalSteps = 3;
        
        // Инициализация калькулятора
        updateCalculator();
        
        // Обработчики для формы
        calculatorForm.addEventListener('input', updateCalculator);
        calculatorForm.addEventListener('change', updateCalculator);
        
        // Навигация по шагам
        nextBtn.addEventListener('click', function() {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateSteps();
                }
            }
        });
        
        prevBtn.addEventListener('click', function() {
            if (currentStep > 1) {
                currentStep--;
                updateSteps();
            }
        });
        
        // Отправка формы
        calculatorForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Здесь будет AJAX запрос
            const formData = new FormData(this);
            
            // Показываем модальное окно успеха
            const calculatorModal = bootstrap.Modal.getInstance(document.getElementById('calculatorModal'));
            calculatorModal.hide();
            
            setTimeout(() => {
                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                successModal.show();
                
                // Очищаем форму
                calculatorForm.reset();
                currentStep = 1;
                updateSteps();
            }, 300);
        });
        
        function validateStep(step) {
            // Простая валидация
            if (step === 1) {
                const length = calculatorForm.querySelector('[name="length"]').value;
                const width = calculatorForm.querySelector('[name="width"]').value;
                return length && width && length > 0 && width > 0;
            }
            return true;
        }
        
        function updateSteps() {
            // Обновляем шаги
            steps.forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.toggle('active', stepNum === currentStep);
            });
            
            // Обновляем контент шагов
            stepContents.forEach(content => {
                const stepNum = content.id.replace('step', '');
                content.classList.toggle('active', parseInt(stepNum) === currentStep);
            });
            
            // Обновляем кнопки
            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            nextBtn.style.display = currentStep < totalSteps ? 'block' : 'none';
            submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';
            
            // Обновляем расчет
            updateCalculator();
        }
        
        function updateCalculator() {
            // Получаем данные из формы
            const length = parseFloat(calculatorForm.querySelector('[name="length"]').value) || 10;
            const width = parseFloat(calculatorForm.querySelector('[name="width"]').value) || 8;
            const height = parseFloat(calculatorForm.querySelector('[name="height"]').value) || 3;
            const floors = parseFloat(calculatorForm.querySelector('[name="floors"]').value) || 1.5;
            
            // Выбранная модель
            const selectedModel = calculatorForm.querySelector('[name="model"]:checked');
            const model = selectedModel ? selectedModel.value : 'standard';
            
            // Цены за м² для разных моделей
            const prices = {
                'standard': 1850,
                'plus': 2150,
                'premium': 2650,
                'seismic': 3150
            };
            
            // Расчет
            const perimeter = (length + width) * 2;
            const wallArea = perimeter * height * floors * 0.8; // 0.8 - коэффициент на проемы
            const blocksCount = Math.ceil(wallArea * 4); // 4 блока на м²
            const materialsCost = Math.ceil(wallArea * prices[model]);
            const totalCost = Math.ceil(materialsCost * 1.15); // +15% на работы
            
            // Обновляем результаты
            document.getElementById('wallAreaResult').textContent = Math.round(wallArea) + ' м²';
            document.getElementById('blocksResult').textContent = '~' + blocksCount + ' шт';
            document.getElementById('materialsResult').textContent = '~' + materialsCost.toLocaleString('ru-RU') + ' ₽';
            document.getElementById('totalResult').textContent = '~' + totalCost.toLocaleString('ru-RU') + ' ₽';
        }
        
        // Инициализация
        updateSteps();
    });
</script>